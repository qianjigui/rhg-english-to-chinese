---
title: 前言
---

# 前言

本书后续的各个主题主要围绕以下目标展开:

- 了解*ruby*语言的结构
- 通过Ruby语言解释器去学习一个*程序语言处理系统*的各个方面
- 提升开源代码学习与阅读能力

*Ruby*是由日本程序员松本行弘开发的一种面向对象的动态编程语言.
针对该语言的规范, 目前市面上有多种解释器, 例如CRuby,JRuby等.
*Ruby*语言的官方实现版本被称为*ruby*(CRuby).
目前官方的ruby解释器主要由开源社区进行开发与维护.

本书的第一个目标是深入语言处理系统内部, 去理解*ruby*语言实现的内部工作工作机理.
然后, 我们将通过学习Ruby解释器的实现, 来类比了解其它语言解释器的技术内容.
笔者在描述解释器实现的过程中, 会尽量涉及实现一个程序语言解释器的必要技术点, 例如: Hash表, 词法扫描器, 语法分析器, 运行时环境 等相关内容.
当然, 由于本书不是一本专门讲解编译原理的教科书, 对涉及的相关技术点可能不会全面的进行介绍与扩展, 请读者自行选择与学习.
不过涉及到实现的关键技术点与体系结构, 本书也将根据情况进行内容展开.
读者也不用担心在阅读时对Ruby没有了解, 在本书内容中会涵盖Ruby语言的相关实现与技术点.

本书的重点是上述两个主题, 不过笔者在这里需要强调的是本书的第三个主题: 学习与掌握开源代码的阅读与学习能力. 这个主题是贯穿全书的中心, 笔者将详细解释这个中心的重要性.
常言道, "博闻强识", 一个优秀的程序员, 是需要阅读与学习优秀的开源代码的.
不过到目前为止,笔者并没有找到一本专门介绍阅读他人代码的方法的书.
市面上有大量讲解操作系统内核,编译原理的书, 但是这些书仅告诉读者了整体结构与实现的最终结果, 并没有将中间的分析与学习过程总结出来, 而这方面仍是大家缺少的.
广大程序员能够体会, "会写代码,并不代表可以读懂他人编写的代码", 而实际情况是 阅读代码与编写代码一样, 让大家觉得困难.

因此本书并不准备讲解大家使用过程中的Ruby, 而是希望能够将对内容实现的分析过程一五一十的总结出来, 更希望通过图形等方法向大家进行展现.
虽然, 笔者自认为自己已经是一个熟练的Ruby开发人员, 但在写本书之前, 笔者也没有深入了解ruby语言的内部工作机制与原理.
换句话说, 在深入学习Ruby内部实现前, 笔者除了在Ruby使用上有一些经验外, 对Ruby的内部实现与广大读者可能是相同的.
本书就是一本希望了解Ruby内部实现的开发者, 从这个目标出发的整个学习过程的完整记录.

在本书的编写过程中, 笔者与Ruby语言的作者进行了沟通, 并请他对本书内容进行审校.
为了更好的保持本书的初衷, 笔者在编写本书的最后阶段才请审校者进行审校.
在全书中, 笔者仍然保留了大量源代码的思考过程, 以传达源代码学习的方法与总结.

实话实说, 本书的创作并不那么简单.
其中的一个原因, 就是将上面这些复杂的主题进行简单地表述.
不过这种内部的复杂性也正是本书的乐趣所在.
这种感觉就像去分享一块蛋糕, 专心地处理一个问题. 如果想真正地有新的收获, 就需要在学习的过程中去解决不知道的问题.
我也很希望大家能够通过解决总是来提高自己, 并从中获取开心.

# 读者对象

首先, 在阅读本书时, 仅仅了解Ruby语言的特性是不够的.
真正地学习一门语言, 需要深入地理解语言的内部实现, 组织结构, 以及实现细节的方方面面.

需要读者有一定的C语言基础, 应该知道如何通过`malloc()`去实现一个链表, 栈, 并了解C语言的函数指针等基本概念.

最好读者有一定的面向对象程序开发的知识, 这样在理解面向对象的相关细节时, 不会出现问题. 笔者会通过C++, Java 这些面向对象的语言进行解释.

# 本书的结构

全书分为四个部分:

| 部分 | 内容 |
|------|------|
| 第一部分| Ruby中的基本结构与对象 |
| 第二部分| Ruby中的句法分析(词法,语法,语义) |
| 第三部分| Ruby中的运行解释过程 |
| 第四部分| Ruby中的运行时环境 |

很多补充章节会出现在每个部分的开头. 这些章节主要用来介绍一些关于Ruby语言与语言实现基本机制的内容, 以便于不了解相关内容的读者可以有个整体的了解.

书中的`(C),(B),(A),(S)`标识了本部分的难易程度, 从左到右依次加深难度.

## 第一部分: 基本结构与对象

| 章节 | 内容提要 | 难易程度 |
|------|----------|----------|
| 1    | 本部分阅读需要了解的Ruby基础知识 | (C) |
| 2    | Ruby 对象的内部实现结构 | (C) |
| 3    | Hash表的状态 | (C) |
| 4    | Ruby 的对象/类系统(对象模型), 建议先整体游览本章节, 从中看到一些用于讲解的小故事 | (A) |
| 5    | Ruby解释器的垃圾收集机制, 主要是关于对象的分配与释放. 本章是第一个下层实现的知识 | (B) |
| 6    | 讲述全局变量, 类变量, 常量的内部实现 | (C) |
| 7    | Ruby的安全机制 | (C) |

## 第二部分: Ruby的句法分析

| 章节 | 内容提要 | 难易程度 |
|------|----------|----------|
| 8    | Ruby的语言规范 | (C) |
| 9    | yacc介绍, 用于学习与描述语法规则 | (B) |
| 10   | 语法分析器的规则与实现结构 | (A) |
| 11   | 探索*lex*词法状态的外围环境 | (S) |
| 12   | 本章总结, 下章介绍 | (C) |

## 第三部分: Ruby的运行引擎

| 章节 | 内容提要 | 难易程度 |
|------|----------|----------|
| 13   | 运行引擎的基本机制 | (C) |
| 14   | Ruby的运行时环境与运行栈 | (A) |
| 15   | Ruby方法的初始化与索引   | (B) |
| 16   | Ruby语言的迭代器, 字符串体系的实现 | (A) |
| 17   | Ruby语言中eval方法的实现 | (B) |

## 第四部分: Ruby解释器的相关环境

| 章节 | 内容提要 | 难易程度 |
|------|----------|----------|
| 18   | 扩展库与依赖库的加载过程 | (B) |
| 19   | Ruby的线程体系 | (A) |

# 学习环境

本书针对CRuby 1.7.3 2002-09-12 版本进行描述, 相关代码附在CD中.
读者可以在[官方网站](https://www.ruby-lang.org/en/) 下载相关代码.

在如下环境可以进行编译与调试:

* BeOS 5 Personal Edition/i386
* Debian GNU/Linux potato/i386
* Debian GNU/Linux woody/i386
* Debian GNU/Linux sid/i386
* FreeBSD 4.4-RELEASE/Alpha (Requires the local patch for this book)
* FreeBSD 4.5-RELEASE/i386
* FreeBSD 4.5-RELEASE/PC98
* FreeBSD 5-CURRENT/i386
* HP-UX 10.20
* HP-UX 11.00 (32bit mode)
* HP-UX 11.11 (32bit mode)
* Mac OS X 10.2
* NetBSD 1.6F/i386
* OpenBSD 3.1
* Plamo Linux 2.0/i386
* Linux for PlayStation2 Release 1.0
* Redhat Linux 7.3/i386
* Solaris 2.6/Sparc
* Solaris 8/Sparc
* UX/4800
* Vine Linux 2.1.5
* Vine Linux 2.5
* VineSeed
* Windows 98SE (Cygwin, MinGW+Cygwin, MinGW+MSYS)
* Windows Me (Borland C++ Compiler 5.5, Cygwin, MinGW+Cygwin, MinGW+MSYS, Visual C++ 6)
* Windows NT 4.0 (Cygwin, MinGW+Cygwin)
* Windows 2000 (Borland C++ Compiler 5.5, Visual C++ 6, Visual C++.NET)
* Windows XP (Visual C++.NET, MinGW+Cygwin)

本书在编写与代码测试过程中得到了如下朋友的帮助, 在这里表示感谢.

| Tietew |
| kjana |
| nyasu |
| sakazuki |
| Masahiro Sato |
| Kenichi Tamura |
| Morikyu |
| Yuya Kato |
| Yasuhiro Kubo |
| Kentaro Goto |
| Tomoyuki Shimomura |
| Masaki Sukeda |
| Koji Arai |
| Kazuhiro Nishiyama |
| Shinya Kawaji |
| Tetsuya Watanabe |
| Naokuni Fujimoto |

本书内容如果有什么问题, 请反馈到 `aamine@loveruby.net`

# 相关网站

本书站点: http://i.loveruby.net/ja/rhg/

最新的更新内容与附加材料, 将在本网站进行提供.

# 感谢

首先, 我需要感谢Ruby语言的作者.
感谢其将Ruby进行了开源, 并在本书的编写过程中给予了指导与建议, 审校.

其次, 感谢arton先生, 是他帮助本书出版.

Koji Arai先生在Ruby社区中对本书进行了审校与帮助, 在此表示感谢.

在此, 同样对以下朋友表示感谢:

Tietew,
Yuya,
Kawaji,
Gotoken,
Tamura,
Funaba,
Morikyu,
Ishizuka,
Shimomura,
Kubo,
Sukeda,
Nishiyama,
Fujimoto,
Yanagawa,

如有遗漏, 表示抱歉.
在此感谢所有对本书帮助的朋友.
